{
  "name": "concessionaria_automation",
  "nodes": [
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "base64",
        "options": {
          "mimeType": "audio/ogg"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        -2224,
        160
      ],
      "id": "d95cb499-71ac-4cec-a702-81f9f4d0c7ea",
      "name": "Converte o base64 em audio"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "base64",
        "options": {
          "mimeType": "image/jpeg"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        -2224,
        480
      ],
      "id": "30633650-9198-4419-b707-49404b5242c6",
      "name": "Converte o base64 em audio1"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://n8n-automacoes-evolution-api.mm95cz.easypanel.host/chat/getBase64FromMediaMessage/garage_automation",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"message\": {\n    \"key\": {\n      \"id\": \"{{ $('Recebe Mensagem').item.json.body.data.key.id }}\"\n    }\n  },\n  \"convertToMp4\": true\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2480,
        480
      ],
      "id": "99be81a5-9b93-4310-8c2f-6be51e9efc29",
      "name": "Pega base64 imagem",
      "credentials": {
        "httpHeaderAuth": {
          "id": "MVRTme0iLFo0Hp00",
          "name": "evoltuion-api_garage_automation"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://n8n-automacoes-evolution-api.mm95cz.easypanel.host/chat/getBase64FromMediaMessage/garage_automation",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"message\": {\n    \"key\": {\n      \"id\": \"{{ $('Recebe Mensagem').item.json.body.data.key.id }}\"\n    }\n  },\n  \"convertToMp4\": true\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2496,
        160
      ],
      "id": "e86cd580-afcd-4a81-a916-c2d968f7fee6",
      "name": "Pega base64 audio",
      "credentials": {
        "httpHeaderAuth": {
          "id": "MVRTme0iLFo0Hp00",
          "name": "evoltuion-api_garage_automation"
        }
      }
    },
    {
      "parameters": {
        "content": "## Recebe Mensagem, verifica o cliente e trava a automaÃ§Ã£o em caso de interferÃªncia humana\n\n",
        "height": 768,
        "width": 1184,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -3936,
        64
      ],
      "id": "fac3055c-5f1e-4748-9d71-50aaf495c5f7",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "numberInputs": 3
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -1792,
        304
      ],
      "id": "a2c28d1d-66e1-444c-9caa-a321943e1d7f",
      "name": "Unifica os dados"
    },
    {
      "parameters": {
        "resource": "image",
        "operation": "analyze",
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "text": "O que tem nessa imagem ? me de a resposta como se fosse um cliente descrevendo na imagem, comece dizendo: te enviei uma imagem que... Sempre em primeira pessoa, como se vocÃª fosse o cliente. Ao invÃ©s de dizer vocÃª me enviou, diga eu te enviei",
        "inputType": "base64",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        -2000,
        480
      ],
      "id": "fcbb7151-0b03-4364-821c-7dda2dd129e1",
      "name": "Analisa Imagem",
      "credentials": {
        "openAiApi": {
          "id": "16UpxIOAFlytv19r",
          "name": "openAI_QUICK"
        }
      }
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        -1984,
        160
      ],
      "id": "a210cb66-70a9-42b3-ab10-12af0402a3f3",
      "name": "Transcreve audio",
      "credentials": {
        "openAiApi": {
          "id": "16UpxIOAFlytv19r",
          "name": "openAI_QUICK"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Filtra os dados').item.json.wpp.TipoDeMensagem }}",
                    "rightValue": "audioMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "e153912c-6097-4dd5-a97a-0bf40ea7bfee"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Audio"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "20f6f952-5976-4efa-9052-6017953b99ee",
                    "leftValue": "={{ $('Filtra os dados').item.json.wpp.TipoDeMensagem }}",
                    "rightValue": "conversation",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Texto"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "fab25a51-da5b-445f-835f-984e0b2bce11",
                    "leftValue": "={{ $('Filtra os dados').item.json.wpp.TipoDeMensagem }}",
                    "rightValue": "imageMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Imagem"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -2720,
        352
      ],
      "id": "6c7c4909-cfe2-4f4e-b0bd-8b1ccb6d0e1a",
      "name": "Tipagem de mensagem"
    },
    {
      "parameters": {
        "content": "## Identifica tipo de mensagem e analisa imagem e transcreve audio\n\n",
        "height": 768,
        "width": 1072,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -2736,
        64
      ],
      "id": "c12ceb99-f17c-40ec-8a6d-ce9a977979f9",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "operation": "get",
        "propertyName": "Name",
        "key": "={{ 'garage:queue:' + $('Filtra os dados').item.json.cliente.Numero }}",
        "options": {}
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1328,
        144
      ],
      "id": "80871aab-d531-4eeb-99f8-6894840f5a81",
      "name": "BuscaMensagem",
      "credentials": {
        "redis": {
          "id": "Xf7ecXrJNgAhCGHC",
          "name": "Redis_automacoes"
        }
      }
    },
    {
      "parameters": {
        "operation": "push",
        "list": "={{ 'garage:queue:' + $('Filtra os dados').item.json.cliente.Numero }}",
        "messageData": "={{ $json.values().join(\"\\n\") }}"
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1584,
        144
      ],
      "id": "886e844a-8bda-4a1e-8b22-0b005e3d577f",
      "name": "RegistraMensagem",
      "credentials": {
        "redis": {
          "id": "Xf7ecXrJNgAhCGHC",
          "name": "Redis_automacoes"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "3a0a3160-d328-40a7-b272-62a3353833b5",
              "leftValue": "={{ $json.Name.length }}",
              "rightValue": 3,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1488,
        384
      ],
      "id": "f06124d1-fddb-4edc-93d1-7811b21085be",
      "name": "verificaSeTemMaisMensagens"
    },
    {
      "parameters": {
        "operation": "get",
        "propertyName": "Name",
        "key": "={{ 'garage:queue:' + $('Filtra os dados').item.json.cliente.Numero }}",
        "options": {}
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1408,
        608
      ],
      "id": "b906d45d-8ef4-427e-a996-fe9bddaa2359",
      "name": "VerificaMensagem",
      "credentials": {
        "redis": {
          "id": "Xf7ecXrJNgAhCGHC",
          "name": "Redis_automacoes"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0d01b254-3522-434f-b13b-1ade5326141e",
              "name": "Name",
              "value": "={{ $json.Name.reverse().join(\"\\n\") }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1216,
        608
      ],
      "id": "21109759-ae0b-4f0a-bfd3-a4134f4afca1",
      "name": "OrganizaMensagem"
    },
    {
      "parameters": {
        "content": "## Cria uma fila de mensagens",
        "height": 768,
        "width": 992,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1648,
        64
      ],
      "id": "05f813db-43c9-438e-a858-9676a5c8a5de",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "3980cad6-e119-4c2b-a434-7f12c8ad4299",
              "name": "Mensagem",
              "value": "={{ $('Filtra os dados').item.json.wpp.Mensagem }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2336,
        320
      ],
      "id": "beb70091-a595-435c-954a-dd22158190ab",
      "name": "MensagemTexto"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('OrganizaMensagem').item.json.Name }}",
        "options": {
          "systemMessage": "=VocÃª Ã© um assistente virtual especializado em atendimento para concessionÃ¡rias de veÃ­culos.\nSeu objetivo Ã© oferecer um atendimento cordial, profissional e objetivo, respondendo dÃºvidas, coletando informaÃ§Ãµes do cliente e encaminhando para o setor correto quando necessÃ¡rio.\n\n1. CONTEXTO\nA concessionÃ¡ria trabalha com compra, venda e financiamento de veÃ­culos novos e seminovos, alÃ©m de serviÃ§os de manutenÃ§Ã£o, agendamento de revisÃµes e pÃ³s-venda.\n\nO agente entende que pode receber solicitaÃ§Ãµes como:\n- Ver catÃ¡logo de carros\n- Consultar modelo, preÃ§o, ano, quilometragem\n- Financiamento\n- Test drive\n- RevisÃ£o\n- Suporte pÃ³s-venda\n- Triagem inicial do cliente\n\n2. TOM DE VOZ\n- Educado, simpÃ¡tico, humanizado\n- PortuguÃªs BR\n- Frases curtas\n- Usar 1 emoji a cada 5 mensagens\n- Evitar parecer robÃ´\n\n3. COMPORTAMENTO\n- Sempre chamar o cliente pelo nome {{ $('Filtra os dados').item.json.cliente.Nome }}\n- SEMPRE ENVIAR TODAS AS FOTOS DO CARRO QUANDO USAR FILTROS DE PESQUISA\n- Identificar o tipo de solicitaÃ§Ã£o\n- SEMPRE Coletar informaÃ§Ãµes essenciais (nome, telefone, modelo, data etc.)\n- Nunca inventar valores, preÃ§os ou disponibilidade\n- NÃ£o enviar placa de veÃ­culo ao cliente\n- Encerrar confirmando se o cliente precisa de algo mais\n\n4. FORMATAÃ‡ÃƒO\n- SEMPRE ENVIAR DESCRIÃ‡ÃƒO DOS CARROS COM CADA CARRO ENVIADO AO CLIENTE COM QUILOMETRAGEM, NOME, MODELO, OBSERVAÃ‡ÃƒO\n- Sempre enviar mensagens em parÃ¡grafos separados\n- Sempre enviar informaÃ§Ãµes do veÃ­culo obrigatoriamente\n- Sempre enviar imagens em mensagens separadas\n- NÃ£o formatar links\n- SEMPRE Criar um texto curto elogiando o carro quando enviar JUNTO com as imagens\n-Quando o cliente pede para ver carros ou o catÃ¡logo, o agente deve:\n-Formular e Adicionar um breve comentÃ¡rio elogiando o carro\n-SEMPRE Responder com informaÃ§Ãµes dos veÃ­culos modelo, marca, valor, quilometragem\n-Incluir imagens separadas, se houver\n-Cada modelo diferente TEM que ser enviado ao cliente junto de um comentÃ¡rio !\n\n5. ğŸ”§ USO DAS TOOLS\n\n==========================\nğŸ”¹ TOOL: consulta_catalogo  \n==========================\n\nQuando o cliente pede para ver carros ou o catÃ¡logo, o agente deve:\n\nFormular e Adicionar um breve comentÃ¡rio elogiando o carro\nSEMPRE Responder com informaÃ§Ãµes dos veÃ­culos modelo, marca, valor, quilometragem\nIncluir imagens separadas, se houver\n- SEMPRE ENVIAR DESCRIÃ‡ÃƒO DOS CARROS COM CADA CARRO ENVIADO AO CLIENTE COM QUILOMETRAGEM, NOME, MODELO, OBSERVAÃ‡ÃƒO\n- SEMPRE ENVIAR TODAS AS FOTOS DO CARRO QUANDO USAR FILTROS DE PESQUISA\n\n  \"foto\": ,\n  \"Modelo\": \"Hilux\",\n  \"Marca\": \"Toyota\",\n  \"quilometragem\": 0,\n  \"valor\": 0,\n  \"Desc\": \"Ano do modelo, excelente carro para qualquer uso! ğŸš—\"\n\n\nMODO DE USO\nEsta tool SEMPRE vem antes da tool de filtros.\n\nSÃ³ apÃ³s o retorno Ã© que o agente pode perguntar: \"Quer filtrar por marca, modelo, valor mÃ¡ximo ou quilometragem mÃ¡xima?\"\n\n==========================\nğŸ”¹ TOOL: consultar_usuario\n==========================\n\nUsar **sempre antes de Criar_carros**, para verificar se o usuÃ¡rio Ã© ADMIN\nenvie o email para a tool.\n\n\nSomente chamar quando o cliente fornecer o e-mail.\n\n==========================\nğŸ”¹ TOOL: Criar_carros\n==========================\n\nSomente usar se:\n1. O usuÃ¡rio for ADMIN (confirmado via consultar_usuario)\n2. Todas as informaÃ§Ãµes do carro forem coletadas\n\nJSON obrigatÃ³rio:\n{\n  \"placa\": \"\",\n  \"quilometragem\": ,\n  \"modelo\": \"\",\n  \"marca\": \"\",\n  \"ano\": ,\n  \"valor\": ,\n  \"observacoes\": \"\"\n}\n\nNunca chamar se o usuÃ¡rio nÃ£o for ADMIN.\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -2832,
        896
      ],
      "id": "4680d838-95ba-4c7b-8817-7e9b6989140f",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -3312,
        1120
      ],
      "id": "0dab212d-4b50-4a13-94ae-abb8b8826b72",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "16UpxIOAFlytv19r",
          "name": "openAI_QUICK"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -1040,
        208
      ],
      "id": "9caac5d9-4594-4b8a-92f8-a9326cbb14ac",
      "name": "No Operation, do nothing"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Filtra os dados').item.json.cliente.Numero }}",
        "contextWindowLength": 15
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        -3168,
        1120
      ],
      "id": "aeccc601-403d-4ba0-af88-ddd79e238382",
      "name": "Postgres Chat Memory",
      "credentials": {
        "postgres": {
          "id": "hYlZNKaFXxpWE2k9",
          "name": "postg_concessionaria"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "={{ 'garage:queue:' + $('Filtra os dados').item.json.cliente.Numero }}"
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -976,
        608
      ],
      "id": "acfe07c2-9560-448a-b44b-0d9485377de4",
      "name": "limpa a fila",
      "credentials": {
        "redis": {
          "id": "Xf7ecXrJNgAhCGHC",
          "name": "Redis_automacoes"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "={{ 'garage:queue:' + $('Filtra os dados').item.json.cliente.Numero }}"
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1264,
        368
      ],
      "id": "29d57afa-6061-4736-9b93-f712b466aee9",
      "name": "limpando os testes de fluxo",
      "credentials": {
        "redis": {
          "id": "Xf7ecXrJNgAhCGHC",
          "name": "Redis_automacoes"
        }
      }
    },
    {
      "parameters": {
        "content": "## Agente de IA\n",
        "height": 448,
        "width": 1104,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -3504,
        848
      ],
      "id": "db32888f-d8ba-4761-bef8-ef74be30e35f",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "3200bdfe-5881-43e0-9991-921c18a96289",
              "name": "Resposta",
              "value": "={{ $('AI Agent').item.json.output.split('\\n\\n')  }}",
              "type": "array"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2320,
        1376
      ],
      "id": "fe0e2cf5-ed0b-49b2-9f6b-3cf8411581f9",
      "name": "SeparandoMensagemEmPartes"
    },
    {
      "parameters": {
        "fieldToSplitOut": "Resposta",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -2288,
        1584
      ],
      "id": "de069bc0-f872-4914-ad8c-a8559beacee7",
      "name": "Split Out"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "name": "Replace Me",
      "typeVersion": 1,
      "position": [
        -1504,
        1920
      ],
      "id": "cd1574a2-a6fb-4d77-900f-2ca103318875"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://n8n-automacoes-evolution-api.mm95cz.easypanel.host/message/sendText/garage_automation",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "SUA_EVOLUTION_API_KEY_AQUI"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"number\": {{ JSON.stringify($('Filtra os dados').item.json.cliente.Numero) }},\n  \"text\": {{ JSON.stringify($json.Resposta) }}\n}\n\n\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1808,
        1728
      ],
      "id": "ba9c09d0-6629-4d42-80ed-c2b5b296892c",
      "name": "EnviarespostaAoCliente"
    },
    {
      "parameters": {
        "content": "## Separa, prepara e envia as mensagens uma por uma",
        "height": 880,
        "width": 1136,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -2384,
        1280
      ],
      "id": "7b67d691-88fe-472c-843a-65e9b76c08bf",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -2000,
        1424
      ],
      "id": "ad5e8074-8543-4b1f-b605-23540a35d6d5",
      "name": "envia uma mensagem por vez"
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "value": "public",
          "mode": "list",
          "cachedResultName": "public"
        },
        "table": {
          "__rl": true,
          "value": "messages",
          "mode": "list",
          "cachedResultName": "messages"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "message": 1,
            "phone": "={{ $('Filtra os dados').item.json.cliente.Numero }}",
            "status_followup": 0,
            "ultimo_envio": "={{ $('Filtra os dados').item.json.cliente.Data }}",
            "contexto": "={{ $('Filtra os dados').item.json.wpp.Mensagem }}",
            "name": "={{ $('Filtra os dados').item.json.cliente.Nome }}",
            "encaminha_vendedor": false
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "phone",
              "displayName": "phone",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "message",
              "displayName": "message",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "contexto",
              "displayName": "contexto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "ultimo_envio",
              "displayName": "ultimo_envio",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "status_followup",
              "displayName": "status_followup",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "encaminha_vendedor",
              "displayName": "encaminha_vendedor",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "data_vendedor",
              "displayName": "data_vendedor",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "name",
              "displayName": "name",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2976,
        192
      ],
      "id": "335a7b52-faa9-44ed-bacd-494ef0f66cb3",
      "name": "cadastra o cliente",
      "credentials": {
        "postgres": {
          "id": "hYlZNKaFXxpWE2k9",
          "name": "postg_concessionaria"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "value": "public",
          "mode": "list",
          "cachedResultName": "public"
        },
        "table": {
          "__rl": true,
          "value": "messages",
          "mode": "list",
          "cachedResultName": "messages"
        },
        "where": {
          "values": [
            {
              "column": "phone",
              "value": "={{ $('Filtra os dados').item.json.cliente.Numero }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -3408,
        400
      ],
      "id": "1089c918-7ad5-4e3e-b02c-23f72467e27d",
      "name": "Pega os dados do Cliente",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "hYlZNKaFXxpWE2k9",
          "name": "postg_concessionaria"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "30681789-55d3-4fb4-aea3-f7981c8e99f9",
              "leftValue": "={{ $json }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -3200,
        384
      ],
      "id": "e6b18ee6-d134-4fe7-a3f7-1f76f2cd6fc1",
      "name": "checarCliente"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "b739c470-bcfe-4d75-894b-792bf459b7f1",
              "name": "cliente.Nome",
              "value": "={{ $json.body.data.pushName }}",
              "type": "string"
            },
            {
              "id": "13d7132f-8e39-4bbf-9090-395d7f8cc421",
              "name": "cliente.Numero",
              "value": "={{ $json.body.data.key.remoteJid.replaceAll('@s.whatsapp.net','')  }}",
              "type": "string"
            },
            {
              "id": "801441ac-40c7-4692-b74c-96a113e8b06e",
              "name": "cliente.UltimaMensagem",
              "value": "={{ $json.body.data.key.fromMe }}",
              "type": "boolean"
            },
            {
              "id": "7d300ead-226b-4e42-8d7a-c706861edcd6",
              "name": "wpp.TipoDeMensagem",
              "value": "={{ $json.body.data.messageType }}",
              "type": "string"
            },
            {
              "id": "bc9c971d-43dd-463a-99d8-8d8b19cf9dfe",
              "name": "cliente.Data",
              "value": "={{ $json.body.date_time.toDateTime()}}",
              "type": "string"
            },
            {
              "id": "842be4a9-c5f6-46d5-8f50-7de1279e749a",
              "name": "wpp.Mensagem",
              "value": "={{ $json.body.data.message.audioMessage?.base64 || $json.body.data.message?.base64  || $json.body.data.message.conversation || null }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3680,
        160
      ],
      "id": "25c9bf80-a1dc-4876-b9e9-d43e98f621f1",
      "name": "Filtra os dados"
    },
    {
      "parameters": {
        "toolDescription": "=Use essa tool para consultar os carros da concessionÃ¡ria com filtros.\n\nMAS SEMPRE ENVIE NA TOOL ESSE JSON:\n{\n  \"marca\": \"string\",\n  \"modelo\": \"string\",\n  \"anoMin\": 0,\n  \"anoMax\": 0,\n  \"valorMin\": 0,\n  \"valorMax\": 0,\n  \"quilometragemMax\": \"0\"\n}\n",
        "method": "POST",
        "url": "https://bancoai.com.br/api/public/carros/buscar?empresaId=2",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-API-Key",
              "value": "SUA_BANCOAI_API_KEY_AQUI"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('JSON', ``, 'json') }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        -2960,
        1344
      ],
      "id": "f3318bde-bc15-490f-8901-ebbdf6cc0153",
      "name": "Consulta_carros"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('OrganizaMensagem').item.json.Name }}",
        "messages": {
          "messageValues": [
            {
              "type": "AIMessagePromptTemplate",
              "message": "=VocÃª Ã© um agente ANALISTA de conversas, responsÃ¡vel por analisar as interaÃ§Ãµes entre o cliente e o \"AI Agent\" e atribuir uma avaliaÃ§Ã£o de 0 a 10, onde:\n- 0 significa que Ã© improvÃ¡vel que vire um comprador.\n- 10 significa que Ã© um comprador altamente provÃ¡vel.\n\n\n\n### âš™ï¸ Regras de AvaliaÃ§Ã£o\n\n1. Se a conversa for iniciada ou estiver sendo conduzida por um **usuÃ¡rio admin** pelo nÃºmero {{ $('Filtra os dados').item.json.cliente.Numero.replaceAll('whatsapp.net') }}, ou se contiver mensagens relacionadas a **cadastro de carro, gestÃ£o de sistema ou comandos administrativos**, a avaliaÃ§Ã£o **deve ser obrigatoriamente 0**.\n\n   Exemplos de palavras que indicam um admin:\n   - \"cadastrar carro\", \"adicionar carro\", \"criar carro\", \"consultar usuÃ¡rios\", \"configurar sistema\", \"admin\", \"usuÃ¡rio admin\", \"banco de dados\".\n\n2. Se o cliente demonstrar **intenÃ§Ã£o de compra**, como â€œquero comprarâ€, â€œtenho interesseâ€, â€œquanto custaâ€, â€œfechar negÃ³cioâ€, etc., a avaliaÃ§Ã£o deve ser entre **6 e 10**, indicando um possÃ­vel comprador.\n\n3. Se o cliente apenas fizer perguntas genÃ©ricas, sem intenÃ§Ã£o de compra, atribua uma nota **entre 1 e 5**.\n\nObservaÃ§Ã£o 1:\nAo atingir uma avaliaÃ§Ã£o aceitÃ¡vel (6 ou mais) terÃ¡ que indicar o atendimento para um vendedor.\n\nObservaÃ§Ã£o 2:\nQuando o usuÃ¡rio admin entrar em contato para cadastrar um carro, sua avaliaÃ§Ã£o tem que ser 0.\n\nINSTRUÃ‡ÃƒO:\nResponda apenas em JSON vÃ¡lido com os campos:\n{\n  \"avaliacao\": {{(() => { \n  const text = ($json.message || \"\").toLowerCase(); \n\n  // ğŸ”’ Mensagens administrativas ou de cadastro â†’ 0\n  if (text.match(/\\b(admin|usuÃ¡rio admin|cadastrar carro|adicionar carro|criar carro|consultar usuÃ¡rios|configurar sistema|banco de dados)\\b/)) { \n    return 0; \n  } \n\n  // Regexes separadas para clareza\n  const buyRegex = /\\b(comprar|adquirir|assinar|contratar|fechar negÃ³cio|quero agora|vou comprar|compraria)\\b/;\n  const explicitInterestRegex = /\\b(interessad[ao]|interessa|interesse|quero mais informaÃ§Ãµes|tenho interesse)\\b/;\n  const priceOrQuoteRegex = /\\b(or[eÃ©]amento|or[Ã§c]amento|preÃ§o|quanto custa|valor|cotaÃ§Ã£o|cotacao)\\b/;\n  const modelQueryRegex = /\\b(modelo|versÃ£o|versao|ano|km|quilometragem|placa|chassi|corolla|civic|fiat|ford|chevrolet|volkswagen|vw|toyota|honda|nissan|renault|bmw|mercedes|audi)\\b/;\n\n  // ğŸŸ¢ Compra explÃ­cita â†’ nota alta\n  if (buyRegex.test(text)) return 10;\n\n  // ğŸ”µ Interesse explÃ­cito sem preÃ§o e sem intenÃ§Ã£o de compra â†’ nota BAIXA (< 6)\n  // (ANTES ERA 8 â€” agora ficou 5)\n  if (explicitInterestRegex.test(text) && !priceOrQuoteRegex.test(text) && !modelQueryRegex.test(text)) return 5;\n\n  // ğŸŸ¡ Pedido de orÃ§amento / preÃ§o â†’ nota baixa\n  if (priceOrQuoteRegex.test(text)) return 4;\n\n  // ğŸŸ  Pergunta especÃ­fica sobre modelo/caracterÃ­sticas â†’ nota mÃ©dia\n  if (modelQueryRegex.test(text)) return 5;\n\n  // ğŸ”¹ Outros tons\n  if (text.match(/\\b(pensando|avaliando|talvez)\\b/)) return 5;\n  if (text.match(/\\b(sÃ³ olhando|sÃ³ olhar|curioso|analisando)\\b/)) return 3;\n\n  return 0; \n})()}}\n,\n\n  \"encaminhar_vendedor\": {{ \n    (function() {\n      const text = ($json.message || \"\").toLowerCase();\n\n      // admin sempre falso\n      if (text.match(/\\b(admin|usuÃ¡rio admin|cadastrar carro|adicionar carro|criar carro|consultar usuÃ¡rios|configurar sistema|banco de dados)\\b/)) {\n        return false;\n      }\n\n      // SÃ³ encaminhar vendedor para intenÃ§Ãµes de compra explÃ­citas ou sinais muito fortes\n      const buyRegex = /\\b(comprar|adquirir|assinar|contratar|fechar negÃ³cio|quero agora|vou comprar|compraria)\\b/;\n      const strongIntentRegex = /\\b(estou pronto|posso fechar|fecho agora|tenho urgÃªncia|preciso comprar)\\b/;\n\n      if (buyRegex.test(text) || strongIntentRegex.test(text)) return true;\n\n      // NÃƒO encaminhar automaticamente para orÃ§amentos ou consultas de modelo\n      return false;\n    })()\n  }},\n\n  \"comentario\": \"NÃºmero do cliente {{ $('Filtra os dados').item.json.cliente.Numero.replaceAll('whatsapp.net') }} e uma breve justificativa com o MODELO do CARRO CASO o cliente tenha informado\"\n}\n\n\n"
            }
          ]
        },
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        -2320,
        912
      ],
      "id": "b163c60f-ef5e-4d73-b623-492309f9a1bc",
      "name": "Avaliador"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://n8n-automacoes-evolution-api.mm95cz.easypanel.host/message/sendText/garage_automation",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "SUA_EVOLUTION_API_KEY_AQUI"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({\n  number: \"SEU_NUMERO_VENDEDOR_AQUI\",\n  text: $json.Comentario\n}) }}\n\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -1584,
        880
      ],
      "id": "412c64f6-f9b0-4cd1-aca6-ea0a429dd611",
      "name": "Encaminha_vendedor"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "180197fa-1dbd-45ab-a251-aecc56297961",
              "name": "bot_name",
              "value": "Atendente_virtual",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3440,
        160
      ],
      "id": "87057353-c618-4f5b-8704-cb80cf698019",
      "name": "configuraÃ§Ã£o_global"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "8dc763d4-13eb-4367-be9c-b58c6226ab4b",
              "leftValue": "={{ $('Recebe Mensagem').item.json.body.data.key.fromMe }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -3616,
        400
      ],
      "id": "1b045198-a195-4713-879e-a06aea12035d",
      "name": "FromMe?!"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "445c417d-8822-4489-96f2-4bb4611bfa2f",
              "leftValue": "={{ $json.isBlocked }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -3392,
        608
      ],
      "id": "49a4a4db-9f58-4017-8c22-da7787e45930",
      "name": "Bloqueado?"
    },
    {
      "parameters": {
        "operation": "get",
        "propertyName": "isBlocked",
        "key": "={{ 'garage:queue:' + $('configuraÃ§Ã£o_global').item.json.bot_name }}_{{ $('Filtra os dados').item.json.cliente.Numero }}_block",
        "options": {}
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -3584,
        608
      ],
      "id": "90390b3e-e653-4e42-a2fa-23af55fb8064",
      "name": "isBlocked?",
      "credentials": {
        "redis": {
          "id": "Xf7ecXrJNgAhCGHC",
          "name": "Redis_automacoes"
        }
      }
    },
    {
      "parameters": {
        "operation": "set",
        "key": "={{ 'garage:queue:' + $('configuraÃ§Ã£o_global').item.json.bot_name }}_{{ $('Filtra os dados').item.json.cliente.Numero }}_block",
        "value": "true",
        "expire": true,
        "ttl": 300
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -3792,
        688
      ],
      "id": "70314e11-9ed2-4bd4-8ce7-321420bb479d",
      "name": "chave_bloqueio",
      "credentials": {
        "redis": {
          "id": "Xf7ecXrJNgAhCGHC",
          "name": "Redis_automacoes"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "let text = $json[\"text\"];\n\n// Remove blocos de markdown tipo ```json ... ```\ntext = text.replace(/```json|```/g, \"\").trim();\n\nreturn [\n  {\n    json: JSON.parse(text)\n  }\n];\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2176,
        1104
      ],
      "id": "666dfd47-ca87-46d8-bedb-ef7472bb0ff1",
      "name": "formatacao_json"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "9586adf2-e046-4554-88f7-8868e86f72f9",
              "leftValue": "={{ $('formatacao_json').item.json.encaminhar_vendedor }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1776,
        1008
      ],
      "id": "e3f0ef4d-ab38-49ca-a58a-303234532caf",
      "name": "VENDEDOR?"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -3200,
        592
      ],
      "id": "036884dc-da2d-4d77-81e1-e652642f1c7f",
      "name": "ignorar"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://n8n-automacoes-evolution-api.mm95cz.easypanel.host/message/sendMedia/garage_automation",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "SUA_EVOLUTION_API_KEY_AQUI"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"number\": \"{{ $('Filtra os dados').item.json.cliente.Numero }}\",\n  \"mediatype\": \"image\",\n  \"mimetype\": \"image/jpeg\",\n  \"media\": \"{{ $json.Resposta.match(/https?:\\/\\/[^ )]+/)[0].replace(':80','') }}\",\n  \"fileName\": \"Imagem.jpg\"\n}\n",
        "options": {
          "allowUnauthorizedCerts": true
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -1440,
        1312
      ],
      "id": "f6bc54cf-0544-4558-b6ba-f60d8b883969",
      "name": "EnviaImagemAoCliente"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "7950b0be-e9ce-48ac-87b5-5f5e16191aa6",
              "leftValue": "={{ $json.Resposta }}",
              "rightValue": "http",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1760,
        1440
      ],
      "id": "f40a43cb-4513-460b-90b4-1bec51ae3082",
      "name": "Imagem?"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -1552,
        1136
      ],
      "id": "83f4ff4a-3b3b-4e22-a947-788f613c3a75",
      "name": "ignorar_avaliacao"
    },
    {
      "parameters": {
        "content": "## Avaliador de PossÃ­vel comprador",
        "height": 416,
        "width": 1136
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -2384,
        848
      ],
      "id": "e3a3dd96-bd8e-410e-8c16-2005e4478f43",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "toolDescription": "=Use essa tool somente para cadastrar carros no catÃ¡logo, quando o usuÃ¡rio for o ADMIN",
        "method": "POST",
        "url": "https://bancoai.com.br/api/public/carros",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-API-Key",
              "value": "SUA_BANCOAI_API_KEY_AQUI"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('JSON', ``, 'json') }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        -2560,
        1344
      ],
      "id": "88dd591b-79d6-451c-b06a-fea16d1efd4a",
      "name": "Criar_carros"
    },
    {
      "parameters": {
        "toolDescription": "use essa tool para consultar a permissÃ£o do usuÃ¡rio.",
        "method": "POST",
        "url": "https://bancoai.com.br/api/public/usuario/info",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-API-Key",
              "value": "SUA_BANCOAI_API_KEY_AQUI"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('JSON', ``, 'json') }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        -2752,
        1344
      ],
      "id": "c6b1be85-5e24-44f6-abf1-fb887f32f5b8",
      "name": "consultar_usuario"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -2320,
        1120
      ],
      "id": "6ddd2f48-f8c9-4d15-9e68-8834dd877be0",
      "name": "modelo_gpt",
      "credentials": {
        "openAiApi": {
          "id": "16UpxIOAFlytv19r",
          "name": "openAI_QUICK"
        }
      }
    },
    {
      "parameters": {
        "content": "## Ferramentas \n## de gestÃ£o de carros\n",
        "width": 1104,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -3504,
        1312
      ],
      "id": "bf9320e5-9e93-49fa-89fd-dfb9f584011d",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT phone, contexto, name\nFROM messages \nWHERE status_followup = 0\n  AND encaminha_vendedor = false\n  AND ultimo_envio < NOW() - INTERVAL '2 hours';\n",
        "additionalFields": {}
      },
      "id": "4cfe010b-9ef0-457e-86a2-9139a5d7a17b",
      "name": "Buscar 2h",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 1,
      "position": [
        -704,
        1040
      ],
      "alwaysOutputData": false,
      "credentials": {
        "postgres": {
          "id": "hYlZNKaFXxpWE2k9",
          "name": "postg_concessionaria"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT phone, contexto, name \nFROM messages \nWHERE status_followup = 1\n  AND encaminha_vendedor = false\n  AND ultimo_envio < NOW() - INTERVAL '6 hours';\n",
        "additionalFields": {}
      },
      "id": "8da554fb-0a08-4659-bb16-c37458c0d215",
      "name": "Buscar 6h",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 1,
      "position": [
        -704,
        1456
      ],
      "alwaysOutputData": false,
      "credentials": {
        "postgres": {
          "id": "hYlZNKaFXxpWE2k9",
          "name": "postg_concessionaria"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT phone, contexto, name \nFROM messages \nWHERE status_followup = 2\n  AND encaminha_vendedor = false\n  AND ultimo_envio < NOW() - INTERVAL '24 hours';\n",
        "additionalFields": {}
      },
      "id": "ef655096-f11d-4672-a458-a0e1e99dbbfc",
      "name": "Buscar 24h",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 1,
      "position": [
        -704,
        1824
      ],
      "alwaysOutputData": false,
      "credentials": {
        "postgres": {
          "id": "hYlZNKaFXxpWE2k9",
          "name": "postg_concessionaria"
        }
      }
    },
    {
      "parameters": {
        "content": "## Follow-up de 2,6, 24horas\n",
        "height": 1312,
        "width": 1824,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1232,
        848
      ],
      "id": "b1ac534c-ef49-4d2a-a0f1-7a8d80a186bb",
      "name": "Sticky Note8"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "responses": {
          "values": [
            {
              "role": "system",
              "content": "VocÃª Ã© um assistente que escreve mensagens curtas de follow-up para clientes que pararam de responder. \nEscreva sempre com naturalidade, cordialidade e em portuguÃªs do Brasil. \nSeu objetivo Ã© retomar a conversa sem ser insistente.\n"
            },
            {
              "content": "=Crie uma mensagem amigÃ¡vel de follow-up. O cliente nÃ£o responde hÃ¡ 2 horas.\n\nNome do cliente:\n{{ $json.name }}\n\nContexto:\n{{ $json.contexto }}\n"
            }
          ]
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 2,
      "position": [
        -416,
        1040
      ],
      "id": "44f1d0ee-534c-4906-903e-0905a21cf790",
      "name": "mensagem follow-up 2h",
      "credentials": {
        "openAiApi": {
          "id": "16UpxIOAFlytv19r",
          "name": "openAI_QUICK"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "responses": {
          "values": [
            {
              "role": "system",
              "content": "VocÃª Ã© um assistente que escreve mensagens curtas de follow-up para clientes que pararam de responder. \nEscreva sempre com naturalidade, cordialidade e em portuguÃªs do Brasil. \nSeu objetivo Ã© retomar a conversa sem ser insistente.\n"
            },
            {
              "content": "=Crie uma mensagem amigÃ¡vel de follow-up. O cliente nÃ£o responde hÃ¡ 6 horas.\n\nNome do cliente:\n{{ $json.name }}\n\nContexto:\n{{ $json.contexto }}"
            }
          ]
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 2,
      "position": [
        -416,
        1456
      ],
      "id": "da03beb7-1115-4ad3-87c0-bbbe46eab44a",
      "name": "Mensagem follow-up 6h",
      "credentials": {
        "openAiApi": {
          "id": "16UpxIOAFlytv19r",
          "name": "openAI_QUICK"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "responses": {
          "values": [
            {
              "role": "system",
              "content": "VocÃª Ã© um assistente que escreve mensagens curtas de follow-up para clientes que pararam de responder. \nEscreva sempre com naturalidade, cordialidade e em portuguÃªs do Brasil. \nSeu objetivo Ã© retomar a conversa sem ser insistente.\n"
            },
            {
              "content": "=Crie uma mensagem amigÃ¡vel de follow-up. O cliente nÃ£o responde hÃ¡ 24 horas.\n\nNome do cliente:\n{{ $json.name }}\n\nContexto:\n{{ $json.contexto }}"
            }
          ]
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 2,
      "position": [
        -400,
        1824
      ],
      "id": "ac95129f-a1b5-496b-a6e0-e7c2eb6aff9a",
      "name": "Mensagem follow-up 24h",
      "credentials": {
        "openAiApi": {
          "id": "16UpxIOAFlytv19r",
          "name": "openAI_QUICK"
        }
      }
    },
    {
      "parameters": {
        "toolDescription": "Use essa tool para buscar o catÃ¡logo completo da garagem",
        "url": "https://bancoai.com.br/api/public/carros?empresaId=2",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-API-Key",
              "value": "SUA_BANCOAI_API_KEY_AQUI"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{\n\"empresaId\": 2\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        -3184,
        1344
      ],
      "id": "7777a7a4-d74a-4ec3-96ec-ef5a1adc43eb",
      "name": "consulta_catalogo"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "beaf4022-b243-4282-ab2c-0c02d65f8365",
              "leftValue": "={{ $json.Resposta }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            },
            {
              "id": "6cd562da-4a05-4787-a001-d491955d4632",
              "leftValue": "={{ $json.Resposta }}",
              "rightValue": "---",
              "operator": {
                "type": "string",
                "operation": "notContains"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        -2288,
        1792
      ],
      "id": "6003ca06-51d6-4a0c-bf52-2ac2b2ebb1fd",
      "name": "Filter"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://n8n-automacoes-evolution-api.mm95cz.easypanel.host/message/sendText/garage_automation",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "SUA_EVOLUTION_API_KEY_AQUI"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"number\": {{ JSON.stringify($('Buscar 24h').item.json.phone) }},\n  \"text\": {{ JSON.stringify($json.output[0].content[0].text) }}\n}\n\n\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        16,
        1824
      ],
      "id": "a17b1a00-57d1-4d44-8cfd-d182250a8d58",
      "name": "EnviaFollowUp 24h"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://n8n-automacoes-evolution-api.mm95cz.easypanel.host/message/sendText/garage_automation",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "SUA_EVOLUTION_API_KEY_AQUI"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"number\": {{ JSON.stringify($('Buscar 2h').item.json.phone) }},\n  \"text\": {{ JSON.stringify($json.output[0].content[0].text) }}\n}\n\n\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        32,
        1040
      ],
      "id": "d0fd2d7e-eaab-4ea7-8470-b3a92a7ea4cc",
      "name": "EnviaFollowUp 2h"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://n8n-automacoes-evolution-api.mm95cz.easypanel.host/message/sendText/garage_automation",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "SUA_EVOLUTION_API_KEY_AQUI"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"number\": {{ JSON.stringify($('Buscar 6h').item.json.phone) }},\n  \"text\": {{ JSON.stringify($json.output[0].content[0].text) }}\n}\n\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        16,
        1456
      ],
      "id": "011e08c1-2d63-4af3-b77b-a64a8a8ba000",
      "name": "EnviaFollowUp 6h"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hoursInterval": 2
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -1152,
        1456
      ],
      "id": "6b627002-11a1-43ec-a5e7-640a90ef47c5",
      "name": "cronÃ´metro FollowUp"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "8ddc67e7-15e4-4ceb-86c5-ee4ab47dc9f5",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -3888,
        160
      ],
      "id": "139cb0b3-13c3-4173-92db-32e0d5397556",
      "name": "Recebe Mensagem",
      "webhookId": "8ddc67e7-15e4-4ceb-86c5-ee4ab47dc9f5"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE messages SET status_followup = 1 WHERE phone = $1;",
        "options": {
          "queryReplacement": "={{ $('Buscar 2h').item.json.phone }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        288,
        1040
      ],
      "id": "98642085-3272-49c5-b0a8-219c1dd1027c",
      "name": "UPDATE 2h",
      "credentials": {
        "postgres": {
          "id": "hYlZNKaFXxpWE2k9",
          "name": "postg_concessionaria"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE messages SET status_followup = 2 WHERE phone = $1;",
        "options": {
          "queryReplacement": "={{ $('Buscar 6h').item.json.phone }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        320,
        1456
      ],
      "id": "a54ca252-a4ae-4107-a5ff-e953900bccee",
      "name": "UPDATE 6h",
      "credentials": {
        "postgres": {
          "id": "hYlZNKaFXxpWE2k9",
          "name": "postg_concessionaria"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE messages SET status_followup = 3 WHERE phone = $1;",
        "options": {
          "queryReplacement": "={{ $('Buscar 24h').item.json.phone }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        336,
        1824
      ],
      "id": "99ab2111-9fcd-42d1-b9e6-a65f2a01b84c",
      "name": "UPDATE 24h",
      "credentials": {
        "postgres": {
          "id": "hYlZNKaFXxpWE2k9",
          "name": "postg_concessionaria"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE messages \nSET status_followup = 0, ultimo_envio = NOW()\nWHERE phone = $1;\n",
        "options": {
          "queryReplacement": "={{ $('Filtra os dados').item.json.cliente.Numero }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -3152,
        896
      ],
      "id": "b97b5053-67f9-4aee-9c5f-8aaa982e38f8",
      "name": "Reseta FollowUp",
      "credentials": {
        "postgres": {
          "id": "hYlZNKaFXxpWE2k9",
          "name": "postg_concessionaria"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e3dbc030-6676-4692-a009-0225e1ebee9f",
              "name": "Comentario",
              "value": "={{ $json.comentario }} Nome do cliente {{ $('Filtra os dados').item.json.cliente.Nome }} e o NÃºmero do cliente {{ $('Filtra os dados').item.json.cliente.Numero }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1968,
        1008
      ],
      "id": "066b156e-38c7-4bfb-b754-6f3476deef67",
      "name": "Formatacao"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE messages SET contexto = $1 WHERE phone = $2;",
        "options": {
          "queryReplacement": "={{ $('Filtra os dados').item.json.wpp.Mensagem }}, {{ $('Filtra os dados').item.json.cliente.Numero }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -2976,
        400
      ],
      "id": "34ba54fe-f5e0-4fa3-8308-36d3f17c3e19",
      "name": "AtualizaContexto",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "hYlZNKaFXxpWE2k9",
          "name": "postg_concessionaria"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE messages \nSET encaminha_vendedor = true,\n    data_vendedor = NOW()\nWHERE phone = $1;",
        "options": {
          "queryReplacement": "={{ $('Filtra os dados').item.json.cliente.Numero }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -1392,
        880
      ],
      "id": "9a423dde-73a5-4463-820e-56b53bee3a50",
      "name": "Cancela_FollowUp",
      "credentials": {
        "postgres": {
          "id": "hYlZNKaFXxpWE2k9",
          "name": "postg_concessionaria"
        }
      }
    },
    {
      "parameters": {
        "amount": 2
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -1584,
        608
      ],
      "id": "a7e919d3-0f1f-4ff2-bb31-fe18e3429487",
      "name": "Espera2Segundos",
      "webhookId": "25984ca0-664b-42e8-9ff1-80403eeb4c78"
    },
    {
      "parameters": {
        "amount": 2
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -1808,
        1920
      ],
      "id": "58291564-72b1-4883-8941-c28322cfae57",
      "name": "Espera 2 segundo",
      "webhookId": "7e64b6e7-9da1-4485-8747-107721861246"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE messages\nSET encaminha_vendedor = false,\n    data_vendedor = NULL\nWHERE encaminha_vendedor = true\n  AND data_vendedor < NOW() - INTERVAL '48 hours';",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -976,
        1456
      ],
      "id": "42adc3a7-6329-4fe6-89af-a627d91743a3",
      "name": "reiniciaFollowUp",
      "credentials": {
        "postgres": {
          "id": "hYlZNKaFXxpWE2k9",
          "name": "postg_concessionaria"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Pega base64 imagem": {
      "main": [
        [
          {
            "node": "Converte o base64 em audio1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pega base64 audio": {
      "main": [
        [
          {
            "node": "Converte o base64 em audio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Converte o base64 em audio": {
      "main": [
        [
          {
            "node": "Transcreve audio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Converte o base64 em audio1": {
      "main": [
        [
          {
            "node": "Analisa Imagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analisa Imagem": {
      "main": [
        [
          {
            "node": "Unifica os dados",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "Transcreve audio": {
      "main": [
        [
          {
            "node": "Unifica os dados",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tipagem de mensagem": {
      "main": [
        [
          {
            "node": "Pega base64 audio",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "MensagemTexto",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Pega base64 imagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Unifica os dados": {
      "main": [
        [
          {
            "node": "RegistraMensagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "RegistraMensagem": {
      "main": [
        [
          {
            "node": "BuscaMensagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BuscaMensagem": {
      "main": [
        [
          {
            "node": "verificaSeTemMaisMensagens",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "verificaSeTemMaisMensagens": {
      "main": [
        [
          {
            "node": "limpando os testes de fluxo",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Espera2Segundos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "VerificaMensagem": {
      "main": [
        [
          {
            "node": "OrganizaMensagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OrganizaMensagem": {
      "main": [
        [
          {
            "node": "limpa a fila",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MensagemTexto": {
      "main": [
        [
          {
            "node": "Unifica os dados",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "limpa a fila": {
      "main": [
        [
          {
            "node": "Reseta FollowUp",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Avaliador",
            "type": "main",
            "index": 0
          },
          {
            "node": "SeparandoMensagemEmPartes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SeparandoMensagemEmPartes": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "Filter",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Replace Me": {
      "main": [
        [
          {
            "node": "envia uma mensagem por vez",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "EnviarespostaAoCliente": {
      "main": [
        [
          {
            "node": "Espera 2 segundo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "limpando os testes de fluxo": {
      "main": [
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "envia uma mensagem por vez": {
      "main": [
        [],
        [
          {
            "node": "Imagem?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "cadastra o cliente": {
      "main": [
        [
          {
            "node": "Tipagem de mensagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pega os dados do Cliente": {
      "main": [
        [
          {
            "node": "checarCliente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "checarCliente": {
      "main": [
        [
          {
            "node": "cadastra o cliente",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AtualizaContexto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filtra os dados": {
      "main": [
        [
          {
            "node": "configuraÃ§Ã£o_global",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Consulta_carros": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Avaliador": {
      "main": [
        [
          {
            "node": "formatacao_json",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "configuraÃ§Ã£o_global": {
      "main": [
        [
          {
            "node": "FromMe?!",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "FromMe?!": {
      "main": [
        [
          {
            "node": "chave_bloqueio",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "isBlocked?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "isBlocked?": {
      "main": [
        [
          {
            "node": "Bloqueado?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Bloqueado?": {
      "main": [
        [
          {
            "node": "ignorar",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Pega os dados do Cliente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "formatacao_json": {
      "main": [
        [
          {
            "node": "Formatacao",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "VENDEDOR?": {
      "main": [
        [
          {
            "node": "Encaminha_vendedor",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ignorar_avaliacao",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "EnviaImagemAoCliente": {
      "main": [
        [
          {
            "node": "envia uma mensagem por vez",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Imagem?": {
      "main": [
        [
          {
            "node": "EnviaImagemAoCliente",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "EnviarespostaAoCliente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Criar_carros": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "consultar_usuario": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "modelo_gpt": {
      "ai_languageModel": [
        [
          {
            "node": "Avaliador",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Buscar 2h": {
      "main": [
        [
          {
            "node": "mensagem follow-up 2h",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar 6h": {
      "main": [
        [
          {
            "node": "Mensagem follow-up 6h",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar 24h": {
      "main": [
        [
          {
            "node": "Mensagem follow-up 24h",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "mensagem follow-up 2h": {
      "main": [
        [
          {
            "node": "EnviaFollowUp 2h",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mensagem follow-up 6h": {
      "main": [
        [
          {
            "node": "EnviaFollowUp 6h",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mensagem follow-up 24h": {
      "main": [
        [
          {
            "node": "EnviaFollowUp 24h",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "consulta_catalogo": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Filter": {
      "main": [
        [
          {
            "node": "envia uma mensagem por vez",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "EnviaFollowUp 24h": {
      "main": [
        [
          {
            "node": "UPDATE 24h",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "EnviaFollowUp 2h": {
      "main": [
        [
          {
            "node": "UPDATE 2h",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "EnviaFollowUp 6h": {
      "main": [
        [
          {
            "node": "UPDATE 6h",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "cronÃ´metro FollowUp": {
      "main": [
        [
          {
            "node": "reiniciaFollowUp",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Recebe Mensagem": {
      "main": [
        [
          {
            "node": "Filtra os dados",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Reseta FollowUp": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Formatacao": {
      "main": [
        [
          {
            "node": "VENDEDOR?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AtualizaContexto": {
      "main": [
        [
          {
            "node": "Tipagem de mensagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "chave_bloqueio": {
      "main": [
        []
      ]
    },
    "Encaminha_vendedor": {
      "main": [
        [
          {
            "node": "Cancela_FollowUp",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Espera2Segundos": {
      "main": [
        [
          {
            "node": "VerificaMensagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Espera 2 segundo": {
      "main": [
        [
          {
            "node": "Replace Me",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "reiniciaFollowUp": {
      "main": [
        [
          {
            "node": "Buscar 2h",
            "type": "main",
            "index": 0
          },
          {
            "node": "Buscar 6h",
            "type": "main",
            "index": 0
          },
          {
            "node": "Buscar 24h",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false,
    "saveDataErrorExecution": "all",
    "saveDataSuccessExecution": "all",
    "saveExecutionProgress": true,
    "saveManualExecutions": true,
    "errorWorkflow": "PXDWw54rsFJ3hh00"
  },
  "versionId": "4405f23a-6d24-4a8f-b3ca-1395cfbe284a",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "9c92701cdb48281154ad624eeeca4a6739a2b2ed112fc4a143ad41555270a5c0"
  },
  "id": "PXDWw54rsFJ3hh00",
  "tags": [
    {
      "updatedAt": "2025-11-16T21:16:24.259Z",
      "createdAt": "2025-11-16T21:16:24.259Z",
      "id": "FA3OLmVSTRDXyV7G",
      "name": "multi-worflow"
    },
    {
      "updatedAt": "2025-11-17T22:38:15.246Z",
      "createdAt": "2025-11-17T22:38:15.246Z",
      "id": "xhoDnGPfPGKHnUKN",
      "name": "quickAuto"
    }
  ]
}